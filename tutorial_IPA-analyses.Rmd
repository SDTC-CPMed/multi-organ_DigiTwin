---
title: "IPA analyses"
author: "Xinxiu Lee, Sandra Lilja"
date: "29/04/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ingenuity pathway analysis

IPA is a commercial software, but you can request a free trial here
(<https://digitalinsights.qiagen.com/products-overview/discovery-insights-portfolio/analysis-and-visualization/qiagen-ipa/>).

To reproduce the analyses for generation of curation file, pathway analysis, and prediction of upstream regulators (URs) from our project, follow this pipeline.

1.  Create a project (eg. CIA) in the Project Manager to upload the lists of genes. Choose the list of genes of interest, dependent on which part of the analysis. For generation of curation-file for prediction of inter-organ interactions, include the URs predicted by [NicheNet analysis](#identification-of-cellular-interactions-and-mcdmmo-mcdm-construction), or all genes from the main data input. For pathway analysis or UR prediction, include the DEGs (differentially expressed genes) from the [Differnetial expression analysis](#data-normalization-and-differnetial-expression-analysis).

Note that IPA has a limitation to 5000 genes in the input-file. If \>5000 significant DEGs has been identified, the DEGs need to be prioritized. In this study, we never reached \>5000 significant DEGs, so no prioritization was needed. 


-------------
<img src="https://user-images.githubusercontent.com/51739216/155988719-ef25e83b-24ca-4e51-bd9f-d9a4c15de186.png" width="300" />

**For each list of DEGs (there is one list for each cell type and time point), perform step 2 - 8, 
for UR prediction in IPA.**

2.  Upload the DEGs into the project “Dataset Files”, including their
    corresponding LogFCs and q-values (these values are included in the 
    same files containing DEGs). Based on these data, choose the
    ID “Human gene symbol”, and the observation names
    “Expr Log Ratio” (LogFC) and “Expr False Discovery Rate” (q-val).
    Keep both LogFC and q-val as the same group, “observation 1”. ”Save”
    and name the dataset.
    
    <img src="https://user-images.githubusercontent.com/51739216/155989006-ebb0b1b1-e2bb-4677-93b4-63a636739b6e.png" width="450" />

3.  In the lower right corner, click “Analyze/Filter Dataset” and then
    “Core Analysis” to perform IPA analysis of the data.
    
    <img src="https://user-images.githubusercontent.com/51739216/155743530-21a556a6-26d2-4e3c-95eb-de632dccec07.png" width="450" />

4.  Click ”next”, to get to the settings.
    
    <img src="https://user-images.githubusercontent.com/51739216/155743696-ac146033-b553-44b1-a020-9ca9e8bae46d.png" width="350" />

5.  In the settings. based on this dataset, define “General settings -
    Species” = Human, “Node Types” = All, “Data Sources” = All,
    “Tissues&Cell Lines” = All, and “Mutation” = All.

6.  Run the analyses by “Run Analysis”.
    
    <img src="https://user-images.githubusercontent.com/51739216/156144451-22be3f42-08d2-4698-abef-22737098cfe8.png" width="450" />

7.  All the performed analyses can be found in the “SAR” project under
    “Analyses”. To see and export the results for further analyses, 
    choose your current analysis.
    
    <img src="https://user-images.githubusercontent.com/51739216/156144896-1f4c9511-02df-474c-a4f1-ba39ec1f67ca.png" width="300" />

8.  In the top tab tools, go to “Upstream Analysis” to show the UR
    prediction results. The results can be downloaded by clicking
    <img src="https://user-images.githubusercontent.com/51739216/155744357-86857f73-8111-497d-a716-983ef5abe525.png" width="30" />.
    
    <img src="https://user-images.githubusercontent.com/51739216/155744562-c6748942-bb6f-4fb7-b602-1b0be72e8aaf.png" width="450" />
    
**Note:** For downstream codes to run smoothly, create a directory "data/IPA_UR-prediction", and one sub-directory per time point, eg. "UR_0h_HA_vs_HC". 
The time point must be part of the sub-directory naming.
Save all the output files from IPA (step 8 above) into their respective sub-directories. 
Name the files according to the following structure: "celltype_timepoint_otherInfo.xls", eg. "Bcells_0h_HA_vs_HC.xls".

***Table 2.** Example output from IPA UR prediction.*

![image](https://user-images.githubusercontent.com/51739216/156583602-760e6e9c-5f34-4d0c-b12d-f6dd9a901a7f.png)

### Generate curation file

### Pathway analysis

### Prediction of upstream regulators (URs)
